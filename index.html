<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FlowMatrix - Command Center</title>

    <!-- Ê†∏ÂøÉ‰æùËµñ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.7/dayjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.7/locale/zh-cn.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.7/plugin/isBetween.min.js"></script>

    <!-- Â≠ó‰Ωì -->
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;800&family=JetBrains+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <!-- Ëá™ÂÆö‰πâÊ†∑Âºè -->
    <style>
      :root {
        --font-main: "Outfit", sans-serif;
        --font-mono: "JetBrains Mono", monospace;
      }
      body {
        font-family: var(--font-main);
        background-color: #f0f4f8;
        color: #334155;
      }

      /* ÁéªÁíÉÊãüÊÄÅ */
      .glass-panel {
        background: rgba(255, 255, 255, 0.65);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.5);
      }

      /* Ë±°ÈôêËâ≤Ë∞É (Â¢ûÂº∫Áâà) */
      .q1-bg {
        background: linear-gradient(160deg, #fff1f2 0%, #ffe4e6 100%);
        border-color: #fda4af;
      }
      .q2-bg {
        background: linear-gradient(160deg, #eff6ff 0%, #dbeafe 100%);
        border-color: #93c5fd;
      }
      .q3-bg {
        background: linear-gradient(160deg, #fffbeb 0%, #fef3c7 100%);
        border-color: #fcd34d;
      }
      .q4-bg {
        background: linear-gradient(160deg, #f8fafc 0%, #f1f5f9 100%);
        border-color: #cbd5e1;
      }

      /* Âä®Áîª */
      @keyframes breathe {
        0%,
        100% {
          box-shadow: 0 0 15px rgba(99, 102, 241, 0.2);
          transform: scale(1);
        }
        50% {
          box-shadow: 0 0 30px rgba(99, 102, 241, 0.5);
          transform: scale(1.005);
        }
      }
      .focus-active {
        animation: breathe 3s ease-in-out infinite;
        border: 2px solid #818cf8;
      }

      /* ÊªöÂä®Êù° */
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }

      /* Ê†áÁ≠æ */
      .tag-badge {
        font-size: 0.6rem;
        padding: 2px 6px;
        border-radius: 4px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      /* Êó•ÂéÜÊ†∑Âºè */
      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 4px;
      }
      .calendar-day {
        aspect-ratio: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
        font-size: 0.9rem;
      }
      .calendar-day:hover {
        background-color: #f1f5f9;
      }
      .calendar-day.is-selected {
        background-color: #1e293b;
        color: white;
        font-weight: bold;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }
      .calendar-day.is-today {
        border: 2px solid #6366f1;
        color: #6366f1;
        font-weight: bold;
      }
      .calendar-day.is-today.is-selected {
        color: white;
        border-color: #1e293b;
      }
      .calendar-day.other-month {
        opacity: 0.3;
      }
      .has-task-dot {
        width: 4px;
        height: 4px;
        border-radius: 50%;
        background-color: #10b981;
        margin-top: 2px;
      }
      .is-selected .has-task-dot {
        background-color: #4ade80;
      }

      /* ÁéØÂΩ¢ËøõÂ∫¶Êù° SVG */
      .progress-ring__circle {
        transition: stroke-dashoffset 0.35s;
        transform: rotate(-90deg);
        transform-origin: 50% 50%;
      }
    </style>
  </head>
  <body
    class="h-screen flex flex-col overflow-hidden bg-[url('https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=2564&auto=format&fit=crop')] bg-cover bg-center"
  >
    <div class="absolute inset-0 bg-white/80 backdrop-blur-md z-0"></div>

    <div
      id="app"
      class="relative z-10 h-full flex flex-col max-w-[1600px] mx-auto w-full shadow-2xl bg-white/40 sm:border-x border-white/50"
    >
      <!-- HEADER -->
      <header
        class="px-6 py-3 flex justify-between items-center bg-white/60 border-b border-white/50 backdrop-blur-sm shrink-0"
      >
        <div class="flex items-center gap-3">
          <div
            class="w-9 h-9 rounded-xl bg-slate-800 text-white flex items-center justify-center font-bold text-xl shadow-lg"
          >
            F
          </div>
          <div class="flex flex-col">
            <h1
              class="font-bold text-slate-800 text-lg leading-none tracking-tight"
            >
              FlowMatrix
            </h1>
            <span
              class="text-[10px] text-slate-500 font-medium uppercase tracking-widest mt-0.5"
              >Command Center</span
            >
          </div>
        </div>
        <div class="flex items-center gap-6">
          <div class="hidden sm:flex flex-col items-end mr-2">
            <span
              class="font-mono text-xl font-bold text-slate-700 leading-none tracking-tight"
              >{{ timeDisplay.time }}</span
            >
            <span
              class="text-[10px] font-medium text-slate-400 uppercase tracking-wide"
              >{{ timeDisplay.date }} ¬∑ {{ timeDisplay.day }}</span
            >
          </div>
          <button
            @click="showStats = true"
            class="group relative p-2 rounded-lg hover:bg-white hover:shadow-md transition-all text-slate-500 hover:text-indigo-600"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
              ></path>
            </svg>
          </button>
          <button
            @click="openCalendar"
            class="p-2 rounded-lg hover:bg-white hover:shadow-md transition-all text-slate-500 hover:text-indigo-600"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
              ></path>
            </svg>
          </button>
          <div
            class="w-2 h-2 rounded-full ring-2 ring-white/50"
            :class="loading ? 'bg-amber-400 animate-pulse' : 'bg-emerald-400'"
          ></div>
        </div>
      </header>

      <!-- MAIN CONTENT AREA -->
      <main class="flex-1 flex flex-col p-4 sm:p-6 gap-6 overflow-hidden">
        <!-- 1. TOP: Focus Stage (ÁØÆÂ≠ê) -->
        <section
          class="flex-none transition-all duration-500 ease-in-out"
          :class="basketTask ? 'min-h-[200px]' : 'h-24'"
        >
          <div
            class="w-full h-full rounded-3xl glass-panel shadow-sm hover:shadow-lg overflow-hidden relative flex flex-col items-center justify-center p-4 transition-all duration-300"
            :class="basketTask ? 'focus-active bg-white/90' : 'bg-white/40 border-dashed border-2 border-indigo-200/50 hover:border-indigo-300'"
          >
            <div
              v-if="basketTask"
              class="w-full max-w-5xl flex flex-col items-center text-center z-10 animate-fade-in relative"
            >
              <div
                class="flex flex-col sm:flex-row items-center gap-6 sm:gap-16 w-full justify-center"
              >
                <div class="text-center min-w-[180px]">
                  <div
                    class="font-mono text-5xl sm:text-6xl font-bold text-slate-800 tracking-tighter tabular-nums drop-shadow-sm"
                  >
                    {{ currentTimerDisplay }}
                  </div>
                  <div
                    class="text-[10px] font-bold text-indigo-400 uppercase tracking-widest mt-1"
                  >
                    Focusing Time
                  </div>
                </div>
                <div class="flex-1 min-w-0 max-w-2xl text-center sm:text-left">
                  <div
                    class="flex items-center justify-center sm:justify-start gap-2 mb-2"
                  >
                    <span
                      class="text-[10px] px-1.5 py-0.5 bg-indigo-600 text-white rounded font-bold uppercase tracking-wider"
                      >Now Doing</span
                    >
                    <span
                      v-if="basketTask.tags"
                      v-for="tag in basketTask.tags.split(',')"
                      :key="tag"
                      class="text-[10px] px-1.5 py-0.5 bg-indigo-50 text-indigo-600 rounded border border-indigo-100 font-bold"
                      >#{{ tag.trim() }}</span
                    >
                  </div>
                  <h2
                    class="text-2xl sm:text-3xl font-bold text-slate-800 leading-tight mb-2 line-clamp-2"
                  >
                    {{ basketTask.title }}
                  </h2>
                  <p
                    v-if="basketTask.description"
                    class="text-sm text-slate-500 italic line-clamp-1"
                  >
                    "{{ basketTask.description }}"
                  </p>
                </div>
              </div>
              <div class="flex gap-3 mt-6 sm:absolute sm:bottom-0 sm:right-0">
                <button
                  @click="completeTask(basketTask)"
                  class="bg-slate-800 text-white px-5 py-2 rounded-xl font-bold hover:bg-slate-700 shadow-lg shadow-slate-300 hover:-translate-y-0.5 transition-all active:scale-95 flex items-center gap-2 text-sm"
                >
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2.5"
                      d="M5 13l4 4L19 7"
                    ></path>
                  </svg>
                  ÂÆåÊàê
                </button>
                <button
                  @click="pauseTask(basketTask)"
                  class="bg-white text-slate-600 border border-slate-200 px-3 py-2 rounded-xl font-bold hover:bg-slate-50 transition-all active:scale-95 text-sm"
                >
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M10 9v6m4-6v6"
                    ></path>
                  </svg>
                </button>
              </div>
            </div>

            <div v-else class="flex items-center gap-3 text-slate-400">
              <svg
                class="w-5 h-5 text-indigo-300 animate-bounce"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 14l-7 7m0 0l-7-7m7 7V3"
                ></path>
              </svg>
              <span class="text-sm font-medium opacity-80"
                >ÁÇπÂáª‰∏ãÊñπ‰ªªÂä°ÔºåËøõÂÖ•‰∏ìÊ≥®Ê®°Âºè</span
              >
            </div>
          </div>
        </section>

        <!-- 2. BOTTOM SPLIT: Matrix (Left) + Sidebar (Right) -->
        <div class="flex-1 flex flex-col lg:flex-row gap-6 min-h-0">
          <!-- LEFT: Matrix Grid (Âç†ÊçÆÂ§ßÈÉ®ÂàÜÂÆΩÂ∫¶) -->
          <section
            class="flex-1 grid grid-cols-1 md:grid-cols-2 gap-4 overflow-y-auto pr-1 pb-2"
          >
            <div
              v-for="q in quadrants"
              :key="q.id"
              class="flex flex-col rounded-2xl border shadow-sm h-full min-h-[200px] transition-all hover:shadow-md"
              :class="q.bgClass"
            >
              <div
                class="px-4 py-3 border-b border-black/5 flex justify-between items-center bg-white/40 backdrop-blur-sm rounded-t-2xl sticky top-0 z-10"
              >
                <div class="flex items-center gap-2">
                  <span class="text-lg">{{ q.icon }}</span>
                  <span class="font-bold text-slate-700 text-sm"
                    >{{ q.name }}</span
                  >
                </div>
                <button
                  @click="openAddModal(q.id)"
                  class="w-6 h-6 hover:bg-white rounded flex items-center justify-center text-slate-400 hover:text-indigo-600 transition-colors"
                >
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 4v16m8-8H4"
                    ></path>
                  </svg>
                </button>
              </div>
              <div class="flex-1 p-3 overflow-y-auto space-y-2">
                <div
                  v-for="task in getTasksByQuadrant(q.id)"
                  :key="task.id"
                  @click="moveToBasket(task)"
                  class="bg-white p-3 rounded-xl shadow-sm border border-black/5 cursor-pointer group hover:scale-[1.01] transition-transform relative"
                >
                  <button
                    @click.stop="deleteTask(task.id)"
                    class="absolute top-2 right-2 p-1.5 rounded-md text-slate-300 hover:text-red-500 hover:bg-red-50 opacity-0 group-hover:opacity-100 transition-all z-20"
                  >
                    <svg
                      class="w-3.5 h-3.5"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                      ></path>
                    </svg>
                  </button>
                  <div v-if="task.tags" class="flex flex-wrap gap-1 mb-1.5">
                    <span
                      v-for="tag in task.tags.split(',')"
                      :key="tag"
                      class="tag-badge bg-slate-100 text-slate-500 border border-slate-200"
                      >{{ tag.trim() }}</span
                    >
                  </div>
                  <div
                    class="font-medium text-slate-700 text-sm pr-6 leading-snug"
                  >
                    {{ task.title }}
                  </div>
                  <div
                    class="mt-2 flex items-center justify-between text-xs text-slate-400 border-t border-slate-50 pt-2"
                  >
                    <div class="flex items-center gap-2">
                      <span
                        v-if="task.duration_seconds > 0"
                        class="flex items-center gap-1 font-mono text-indigo-400 font-bold"
                      >
                        <svg
                          class="w-3 h-3"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                          />
                        </svg>
                        {{ formatDuration(task.duration_seconds) }}
                      </span>
                      <span v-if="task.description" title="ÊúâÂ§áÊ≥®"
                        ><svg
                          class="w-3 h-3"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h7"
                          ></path></svg
                      ></span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- RIGHT: Sidebar Console (Âä©ÊâãÊ†è) -->
          <aside
            class="w-full lg:w-80 flex flex-col gap-4 overflow-y-auto no-scrollbar pb-2 h-full"
          >
            <!-- 1. ‰ªäÊó•ËÉΩÈáèÁéØ (‰øùÊåÅ‰∏çÂèò) -->
            <div
              class="glass-panel rounded-2xl p-5 flex flex-col items-center flex-shrink-0"
            >
              <div class="w-full flex justify-between items-center mb-4">
                <span
                  class="text-xs font-bold text-slate-500 uppercase tracking-wider"
                  >‰ªäÊó•ËÉΩÈáè</span
                >
                <span
                  class="text-xs font-mono text-indigo-500 bg-indigo-50 px-2 py-0.5 rounded"
                  >{{ formatHours(todayStats.duration) }}h</span
                >
              </div>

              <div class="relative w-32 h-32">
                <svg class="w-full h-full" viewBox="0 0 120 120">
                  <circle
                    class="text-slate-100"
                    stroke-width="8"
                    stroke="currentColor"
                    fill="transparent"
                    r="52"
                    cx="60"
                    cy="60"
                  />
                  <circle
                    class="text-indigo-500 progress-ring__circle"
                    stroke-width="8"
                    stroke-linecap="round"
                    stroke="currentColor"
                    fill="transparent"
                    r="52"
                    cx="60"
                    cy="60"
                    :stroke-dasharray="326"
                    :stroke-dashoffset="326 - (326 * Math.min(todayProgress, 100) / 100)"
                  />
                </svg>
                <div
                  class="absolute inset-0 flex flex-col items-center justify-center"
                >
                  <span class="text-2xl font-bold text-slate-700"
                    >{{ Math.round(todayProgress) }}%</span
                  >
                  <span class="text-[10px] text-slate-400">of 8h Goal</span>
                </div>
              </div>
            </div>

            <!-- 2. ÁÅµÊÑü‰æøÁ≠æ (‰øùÊåÅ‰∏çÂèò) -->
            <div
              class="glass-panel rounded-2xl p-5 flex flex-col min-h-[180px] flex-shrink-0"
            >
              <div class="flex items-center gap-2 mb-3">
                <svg
                  class="w-4 h-4 text-amber-500"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
                  ></path>
                </svg>
                <span
                  class="text-xs font-bold text-slate-500 uppercase tracking-wider"
                  >ÁÅµÊÑü‰æøÁ≠æ</span
                >
              </div>
              <textarea
                v-model="memoText"
                placeholder="Êúâ‰ªÄ‰πàÊÉ≥Ê≥ïÔºüÈöèÊâãËÆ∞‰∏ãÊù•..."
                class="w-full flex-1 bg-white/50 border border-slate-200 rounded-xl p-3 text-sm focus:ring-2 focus:ring-indigo-500 outline-none resize-none placeholder-slate-400 transition-all"
              ></textarea>
            </div>

            <!-- 3. ÊúÄËøëËææÊàê (‰øÆÊîπÁÇπÔºö‰ΩøÁî® flex-1 ÊíëÊª°Ââ©‰ΩôÈ´òÂ∫¶) -->
            <div class="glass-panel rounded-2xl p-5 flex-1 flex flex-col">
              <div class="flex items-center gap-2 mb-3 flex-shrink-0">
                <svg
                  class="w-4 h-4 text-emerald-500"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 3.214L17 21l-5.714-3.214L5.572 21 7.857 15.214 2.143 12l5.714-3.214L10 3z"
                  ></path>
                </svg>
                <span
                  class="text-xs font-bold text-slate-500 uppercase tracking-wider"
                  >ÊúÄËøëËææÊàê</span
                >
              </div>

              <!-- ‰ªªÂä°ÂàóË°®ÂÆπÂô® -->
              <div class="space-y-2 flex-1 flex flex-col">
                <!-- Êúâ‰ªªÂä°Êó∂ -->
                <div
                  v-for="task in recentCompletedTasks"
                  :key="task.id"
                  class="flex items-center justify-between text-xs bg-white/60 p-3 rounded-lg border border-slate-100 shadow-sm transition-all hover:shadow-md"
                >
                  <span
                    class="truncate max-w-[140px] text-slate-600 line-through opacity-70"
                    :title="task.title"
                    >{{ task.title }}</span
                  >
                  <span
                    class="text-emerald-600 font-mono font-bold bg-emerald-50 px-2 py-0.5 rounded"
                    >{{ formatDuration(task.duration_seconds) }}</span
                  >
                </div>

                <!-- Á©∫Áä∂ÊÄÅ (‰øÆÊîπÔºöÂûÇÁõ¥Â±Ö‰∏≠ÊòæÁ§∫) -->
                <div
                  v-if="recentCompletedTasks.length === 0"
                  class="flex-1 flex flex-col items-center justify-center text-slate-300 gap-2 opacity-60"
                >
                  <svg
                    class="w-8 h-8 opacity-50"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                    ></path>
                  </svg>
                  <span class="text-xs">ËøòÊ≤°ÊúâËÆ∞ÂΩïÔºåÂä†Ê≤πÔºÅ</span>
                </div>
              </div>
            </div>
          </aside>
        </div>
      </main>

      <!-- Modals (Add, Calendar, Stats) remain mostly the same, included below -->

      <!-- Calendar Modal (‰ºòÂåñÁâàÔºöÊï¥‰ΩìÊªöÂä® + Âê∏È°∂Â§¥ÈÉ®) -->
      <div
        v-if="showCalendar"
        class="fixed inset-0 z-[75] flex items-center justify-center p-4"
      >
        <!-- ËÉåÊôØÈÅÆÁΩ© -->
        <div
          class="absolute inset-0 bg-slate-900/30 backdrop-blur-sm"
          @click="showCalendar = false"
        ></div>

        <!-- Modal ÂÆπÂô®Ôºö‰øÆÊîπ‰∏∫ overflow-y-auto ÂÆûÁé∞Êï¥‰ΩìÊªöÂä® -->
        <div
          class="bg-white rounded-3xl shadow-2xl w-full max-w-lg relative z-10 max-h-[85vh] overflow-y-auto animate-fade-in no-scrollbar flex flex-col"
        >
          <!-- 1. Header: Ê∑ªÂä† sticky top-0 ÂÆûÁé∞Âê∏È°∂ÊïàÊûúÔºåÂä†‰∫Ü backdrop-blur Èò≤Ê≠¢ÂÜÖÂÆπÈáçÂè†Êó∂Áúã‰∏çÊ∏Ö -->
          <div
            class="sticky top-0 z-30 p-5 border-b border-slate-100 flex justify-between items-center bg-slate-50/95 backdrop-blur-md"
          >
            <div>
              <h2 class="text-xl font-bold text-slate-800">ÊàêÂ∞±Êó•ÂéÜ</h2>
              <p class="text-xs text-slate-500 font-medium">Êü•ÁúãËøáÂæÄÁöÑËæâÁÖå</p>
            </div>

            <div class="flex items-center gap-4">
              <!-- Êúà‰ªΩÂàáÊç¢Âô® -->
              <div
                class="flex items-center gap-2 bg-white px-2 py-1 rounded-lg border border-slate-200 shadow-sm"
              >
                <button
                  @click="changeMonth(-1)"
                  class="p-1 hover:bg-slate-100 rounded text-slate-400 hover:text-indigo-600 transition-colors"
                >
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15 19l-7-7 7-7"
                    ></path>
                  </svg>
                </button>
                <span
                  class="text-sm font-bold text-slate-700 min-w-[6rem] text-center select-none"
                  >{{ calendarTitle }}</span
                >
                <button
                  @click="changeMonth(1)"
                  class="p-1 hover:bg-slate-100 rounded text-slate-400 hover:text-indigo-600 transition-colors"
                >
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 5l7 7-7 7"
                    ></path>
                  </svg>
                </button>
              </div>

              <!-- Á´ñÂàÜÂâ≤Á∫ø -->
              <div class="h-6 w-px bg-slate-200 hidden sm:block"></div>

              <!-- ÂÖ≥Èó≠ÊåâÈíÆ -->
              <button
                @click="showCalendar = false"
                class="p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-200 rounded-full transition-colors"
              >
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"
                  ></path>
                </svg>
              </button>
            </div>
          </div>

          <!-- 2. Calendar Grid: Áé∞Âú®ÂÆÉÊòØÊµÅÂºèÂ∏ÉÂ±ÄÁöÑ‰∏ÄÈÉ®ÂàÜÔºå‰ºöÈöèÈ°µÈù¢‰∏ÄËµ∑ÊªöÂä® -->
          <div class="p-6 bg-white relative z-10">
            <div class="grid grid-cols-7 gap-4 mb-2 text-center">
              <div
                v-for="d in ['Êó•','‰∏Ä','‰∫å','‰∏â','Âõõ','‰∫î','ÂÖ≠']"
                class="text-xs font-bold text-slate-400"
              >
                {{ d }}
              </div>
            </div>
            <div class="calendar-grid">
              <div
                v-for="day in calendarDays"
                :key="day.dateStr"
                @click="selectDate(day)"
                class="calendar-day"
                :class="{
                                 'other-month': !day.isCurrentMonth,
                                 'is-today': day.isToday,
                                 'is-selected': day.isSelected
                             }"
              >
                <span>{{ day.dayNum }}</span>
                <div v-if="day.hasTask" class="has-task-dot"></div>
              </div>
            </div>
          </div>

          <!-- 3. Day Details: ÁßªÈô§‰∫Ü flex-1 Âíå overflow-y-autoÔºåÊîπ‰∏∫ min-h -->
          <!-- ËøôÊ†∑ÂΩìÂÜÖÂÆπÂ¢ûÂ§öÊó∂ÔºåÂÆÉ‰ºöÊíëÂºÄÊï¥‰∏™ ModalÔºå‰ªéËÄåËß¶ÂèëÂ§ñÂ±ÇÁöÑÊªöÂä® -->
          <div class="bg-slate-50 border-t border-slate-100 p-6 min-h-[300px]">
            <!-- ËÆ∞ÂΩïÊ†áÈ¢ò‰πüÂèØ‰ª•Âê∏È°∂ÔºåÊñπ‰æøÁü•ÈÅìÂú®ÁúãÂì™Â§© (sticky top-[80px] ÊòØÂõ†‰∏∫‰∏äÈù¢Êúâ Header) -->
            <h3
              class="sticky top-[81px] z-20 py-2 bg-slate-50/95 backdrop-blur text-sm font-bold text-slate-700 mb-4 flex items-center gap-2 border-b border-slate-100"
            >
              <svg
                class="w-4 h-4 text-indigo-500"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                ></path>
              </svg>
              {{ selectedDateFormatted }} ÁöÑËÆ∞ÂΩï
            </h3>

            <div v-if="selectedDateTasks.length > 0" class="space-y-3 pb-4">
              <div
                v-for="task in selectedDateTasks"
                :key="task.id"
                class="bg-white p-3 rounded-xl border border-slate-200 shadow-sm flex justify-between items-center group"
              >
                <div class="flex-1 min-w-0 pr-2">
                  <div
                    class="text-sm font-medium text-slate-700 truncate line-through decoration-slate-300"
                  >
                    {{ task.title }}
                  </div>
                  <div class="flex gap-2 mt-1">
                    <span
                      class="text-[10px] bg-green-50 text-green-600 px-1.5 py-0.5 rounded font-mono font-bold"
                      >{{ formatDuration(task.duration_seconds) }}</span
                    >
                    <span
                      v-if="task.quadrant"
                      class="text-[10px] bg-slate-100 text-slate-400 px-1.5 py-0.5 rounded"
                      >Q{{ task.quadrant }}</span
                    >
                  </div>
                </div>
                <button
                  @click="deleteTask(task.id)"
                  class="p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg opacity-0 group-hover:opacity-100 transition-all"
                >
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                    ></path>
                  </svg>
                </button>
              </div>
            </div>
            <div v-else class="text-center py-8 text-slate-400 text-sm italic">
              ËøôÂ§©Ê≤°ÊúâÂÆåÊàê‰ªª‰Ωï‰ªªÂä°
            </div>
          </div>
        </div>
      </div>

      <!-- Add Modal -->
      <div
        v-if="showModal"
        class="fixed inset-0 z-[80] flex items-center justify-center p-4"
      >
        <div
          class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm"
          @click="showModal = false"
        ></div>
        <div
          class="bg-white rounded-2xl shadow-2xl w-full max-w-lg relative z-10 overflow-hidden animate-fade-in"
        >
          <div
            class="h-1.5 w-full"
            :class="getQuadrantColor(newTask.quadrant)"
          ></div>
          <div class="p-6 sm:p-8">
            <h3 class="text-xl font-bold text-slate-800 mb-6">
              Ê∑ªÂä†‰ªªÂä°Ëá≥
              <span :class="getQuadrantTextColor(newTask.quadrant)"
                >{{ getQuadrantName(newTask.quadrant) }}</span
              >
            </h3>
            <div class="space-y-4">
              <div>
                <label
                  class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-1"
                  >Ê†áÈ¢ò</label
                ><input
                  v-model="newTask.title"
                  @keyup.enter="addTask"
                  type="text"
                  placeholder="Ê†∏ÂøÉÁõÆÊ†áÊòØ‰ªÄ‰πàÔºü"
                  class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-lg focus:ring-2 focus:ring-slate-800 outline-none transition-all placeholder-slate-300"
                  autofocus
                />
              </div>
              <div>
                <label
                  class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-1"
                  >Â§áÊ≥®</label
                ><textarea
                  v-model="newTask.description"
                  rows="2"
                  placeholder="ÁªÜËäÇÊèèËø∞..."
                  class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-slate-800 outline-none resize-none"
                ></textarea>
              </div>
              <div>
                <label
                  class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-1"
                  >Ê†áÁ≠æ</label
                ><input
                  v-model="newTask.tags"
                  type="text"
                  placeholder="Design, Urgent..."
                  class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-slate-800 outline-none"
                />
              </div>
              <div>
                <label
                  class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2"
                  >Êõ¥ÊîπË±°Èôê</label
                >
                <div class="flex gap-2">
                  <button
                    v-for="q in quadrants"
                    :key="q.id"
                    @click="newTask.quadrant = q.id"
                    class="flex-1 py-2 rounded-lg text-xs font-bold border transition-all"
                    :class="newTask.quadrant === q.id ? 'bg-slate-800 text-white border-slate-800' : 'bg-white text-slate-500 border-slate-200 hover:bg-slate-50'"
                  >
                    Q{{ q.id }}
                  </button>
                </div>
              </div>
            </div>
            <div class="flex justify-end gap-3 mt-8">
              <button
                @click="showModal = false"
                class="px-5 py-2 text-slate-500 hover:bg-slate-100 rounded-xl text-sm font-bold"
              >
                ÂèñÊ∂à</button
              ><button
                @click="addTask"
                class="px-8 py-2 bg-slate-800 text-white rounded-xl hover:bg-slate-700 shadow-lg text-sm font-bold"
              >
                Ê∑ªÂä†
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Stats Modal (Hidden by default, triggered by button) -->
      <div
        v-if="showStats"
        class="fixed inset-0 z-[70] flex items-center justify-center p-4"
      >
        <div
          class="absolute inset-0 bg-slate-900/30 backdrop-blur-sm"
          @click="showStats = false"
        ></div>
        <div
          class="bg-white rounded-3xl shadow-2xl w-full max-w-2xl relative z-10 overflow-hidden animate-fade-in"
        >
          <div
            class="p-6 sm:p-8 bg-slate-50 border-b border-slate-100 flex justify-between items-center"
          >
            <div>
              <h2 class="text-2xl font-bold text-slate-800">Êï∞ÊçÆÊ¥ûÂØü</h2>
              <p
                class="text-xs text-slate-500 font-medium uppercase tracking-wide"
              >
                Performance Overview
              </p>
            </div>
            <button
              @click="showStats = false"
              class="text-slate-400 hover:text-slate-600 p-2 bg-white rounded-full shadow-sm hover:shadow"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"
                ></path>
              </svg>
            </button>
          </div>
          <div class="p-6 sm:p-8 grid grid-cols-1 md:grid-cols-2 gap-6">
            <div
              class="stat-card-today rounded-2xl p-6 text-white shadow-lg shadow-indigo-200 relative overflow-hidden group"
              style="
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              "
            >
              <h3
                class="text-indigo-100 font-bold uppercase tracking-wider text-xs mb-4"
              >
                Today's Focus
              </h3>
              <div class="flex items-baseline gap-2 mb-1">
                <span class="text-5xl font-mono font-bold"
                  >{{ formatHours(todayStats.duration) }}</span
                ><span class="text-sm font-medium opacity-80">Â∞èÊó∂</span>
              </div>
            </div>
            <div
              class="stat-card-week rounded-2xl p-6 text-slate-800 shadow-lg shadow-sky-100 relative overflow-hidden group"
              style="
                background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
              "
            >
              <h3
                class="text-slate-500 font-bold uppercase tracking-wider text-xs mb-4"
              >
                This Week
              </h3>
              <div class="flex items-baseline gap-2 mb-1">
                <span class="text-5xl font-mono font-bold text-slate-800"
                  >{{ formatHours(weekStats.duration) }}</span
                ><span class="text-sm font-medium text-slate-500">Â∞èÊó∂</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const { createApp, ref, computed, onMounted, onUnmounted, watch } = Vue;
      dayjs.extend(dayjs_plugin_isBetween);
      dayjs.locale("zh-cn");

      // ===========================================
      // TODO: ÈÖçÁΩÆ Supabase
      // ===========================================
      const SUPABASE_URL = "https://xmbdhsiopgklunsplimh.supabase.co";
      const SUPABASE_ANON_KEY =
        "sb_publishable_Z0q1-9gRfvRsl_U5W9oPmQ_aWePMBiF";
      // ===========================================

      const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      createApp({
        setup() {
          const tasks = ref([]);
          const loading = ref(false);
          const showModal = ref(false);
          const showStats = ref(false);
          const showCalendar = ref(false);
          const newTask = ref({
            title: "",
            description: "",
            tags: "",
            quadrant: 1,
          });
          const now = ref(dayjs());

          // ‰æøÁ≠æÂäüËÉΩ (‰ΩøÁî® LocalStorage Êú¨Âú∞Â≠òÂÇ®Ôºå‰∏çÂç†Êï∞ÊçÆÂ∫ì)
          const memoText = ref(localStorage.getItem("flowMatrix_memo") || "");
          watch(memoText, (newVal) => {
            localStorage.setItem("flowMatrix_memo", newVal);
          });

          let timerInterval;

          // Calendar State
          const currentCalendarDate = ref(dayjs());
          const selectedDate = ref(dayjs());

          const quadrants = [
            { id: 1, name: "ÈáçË¶Å‰∏îÁ¥ßÊÄ•", bgClass: "q1-bg", icon: "üî•" },
            { id: 2, name: "ÈáçË¶Å‰∏çÁ¥ßÊÄ•", bgClass: "q2-bg", icon: "üöÄ" },
            { id: 3, name: "Á¥ßÊÄ•‰∏çÈáçË¶Å", bgClass: "q3-bg", icon: "‚ö°" },
            { id: 4, name: "‰∏çÊÄ•‰∏çÈáçË¶Å", bgClass: "q4-bg", icon: "‚òï" },
          ];

          onMounted(() => {
            fetchTasks();
            timerInterval = setInterval(() => {
              now.value = dayjs();
            }, 1000);
          });
          onUnmounted(() => clearInterval(timerInterval));

          const fetchTasks = async () => {
            loading.value = true;
            const { data } = await client
              .from("tasks")
              .select("*")
              .order("created_at", { ascending: false });
            if (data) tasks.value = data;
            loading.value = false;
          };

          const timeDisplay = computed(() => ({
            time: now.value.format("HH:mm:ss"),
            date: now.value.format("YYYY-MM-DD"),
            day: now.value.format("dddd"),
          }));

          const getTasksByQuadrant = (q) =>
            tasks.value.filter((t) => t.quadrant === q && t.status === "todo");
          const basketTask = computed(() =>
            tasks.value.find((t) => t.status === "in_basket")
          );

          const currentTimerDisplay = computed(() => {
            if (!basketTask.value) return "00:00:00";
            const t = basketTask.value;
            let current = 0;
            if (t.start_time)
              current = now.value.diff(dayjs(t.start_time), "second");
            return formatDuration(
              (t.duration_seconds || 0) + (current > 0 ? current : 0)
            );
          });

          const completedTasks = computed(() =>
            tasks.value.filter((t) => t.status === "done")
          );

          // Stats Logic
          const todayStats = computed(() => {
            const today = completedTasks.value.filter((t) =>
              dayjs(t.completed_at).isSame(dayjs(), "day")
            );
            const duration = today.reduce(
              (acc, t) => acc + (t.duration_seconds || 0),
              0
            );
            return { count: today.length, duration: duration };
          });

          // ÁõÆÊ†á 8 Â∞èÊó∂ (28800Áßí) ËÆ°ÁÆóÁôæÂàÜÊØî
          const todayProgress = computed(() => {
            const goal = 28800; // 8 hours
            const percent = (todayStats.value.duration / goal) * 100;
            return Math.min(percent, 100);
          });

          const weekStats = computed(() => {
            const startOfWeek = dayjs().startOf("week");
            const week = completedTasks.value.filter((t) =>
              dayjs(t.completed_at).isAfter(startOfWeek)
            );
            const duration = week.reduce(
              (acc, t) => acc + (t.duration_seconds || 0),
              0
            );
            return { count: week.length, duration: duration };
          });

          // Recent 3 Tasks
          const recentCompletedTasks = computed(() => {
            return completedTasks.value
              .sort(
                (a, b) => new Date(b.completed_at) - new Date(a.completed_at)
              )
              .slice(0, 3);
          });

          // Calendar Logic
          const calendarTitle = computed(() =>
            currentCalendarDate.value.format("YYYYÂπ¥ MMÊúà")
          );
          const calendarDays = computed(() => {
            const startOfMonth = currentCalendarDate.value.startOf("month");
            const startOfGrid = startOfMonth.startOf("week");
            const days = [];
            for (let i = 0; i < 42; i++) {
              const date = startOfGrid.add(i, "day");
              const dateStr = date.format("YYYY-MM-DD");
              const hasTask = completedTasks.value.some(
                (t) => dayjs(t.completed_at).format("YYYY-MM-DD") === dateStr
              );
              days.push({
                dateObj: date,
                dateStr: dateStr,
                dayNum: date.date(),
                isCurrentMonth:
                  date.month() === currentCalendarDate.value.month(),
                isToday: date.isSame(dayjs(), "day"),
                isSelected: date.isSame(selectedDate.value, "day"),
                hasTask: hasTask,
              });
            }
            return days;
          });

          const changeMonth = (delta) => {
            currentCalendarDate.value = currentCalendarDate.value.add(
              delta,
              "month"
            );
          };
          const selectDate = (day) => {
            selectedDate.value = day.dateObj;
          };
          const openCalendar = () => {
            selectedDate.value = dayjs();
            currentCalendarDate.value = dayjs();
            showCalendar.value = true;
          };
          const selectedDateFormatted = computed(() =>
            selectedDate.value.format("MMÊúàDDÊó•")
          );
          const selectedDateTasks = computed(() =>
            completedTasks.value
              .filter((t) =>
                dayjs(t.completed_at).isSame(selectedDate.value, "day")
              )
              .sort(
                (a, b) => new Date(b.completed_at) - new Date(a.completed_at)
              )
          );

          // Helpers
          const formatDuration = (s) => {
            if (!s) return "00:00:00";
            const h = Math.floor(s / 3600),
              m = Math.floor((s % 3600) / 60),
              sec = s % 60;
            return `${p(h)}:${p(m)}:${p(sec)}`;
          };
          const formatHours = (s) => (s / 3600).toFixed(1);
          const p = (n) => n.toString().padStart(2, "0");
          const getQuadrantName = (id) =>
            quadrants.find((q) => q.id === id)?.name;
          const getQuadrantColor = (id) =>
            ({
              1: "bg-red-400",
              2: "bg-blue-400",
              3: "bg-amber-400",
              4: "bg-slate-400",
            }[id]);
          const getQuadrantTextColor = (id) =>
            ({
              1: "text-red-500",
              2: "text-blue-500",
              3: "text-amber-600",
              4: "text-slate-500",
            }[id]);

          // CRUD
          const openAddModal = (q) => {
            newTask.value = {
              title: "",
              description: "",
              tags: "",
              quadrant: q,
            };
            showModal.value = true;
          };
          const addTask = async () => {
            if (!newTask.value.title.trim()) return;
            const temp = { ...newTask.value, status: "todo" };
            const optimisticId = Date.now();
            tasks.value.unshift({
              ...temp,
              id: optimisticId,
              created_at: new Date(),
            });
            showModal.value = false;
            const { data } = await client.from("tasks").insert([temp]).select();
            if (data) {
              const idx = tasks.value.findIndex((t) => t.id === optimisticId);
              if (idx !== -1) tasks.value[idx] = data[0];
            }
          };
          const moveToBasket = async (task) => {
            if (basketTask.value)
              return alert("ËØ∑ÂÖàÂÆåÊàêÊàñÊöÇÂÅúÂΩìÂâç‰∏ìÊ≥®ÁöÑ‰ªªÂä°ÔºÅ");
            task.status = "in_basket";
            task.start_time = new Date().toISOString();
            await client
              .from("tasks")
              .update({
                status: "in_basket",
                start_time: new Date().toISOString(),
              })
              .eq("id", task.id);
          };
          const pauseTask = async (task) => {
            const session = dayjs().diff(dayjs(task.start_time), "second");
            const newTotal = (task.duration_seconds || 0) + session;
            task.status = "todo";
            task.duration_seconds = newTotal;
            task.start_time = null;
            await client
              .from("tasks")
              .update({
                status: "todo",
                duration_seconds: newTotal,
                start_time: null,
              })
              .eq("id", task.id);
          };
          const completeTask = async (task) => {
            const session = task.start_time
              ? dayjs().diff(dayjs(task.start_time), "second")
              : 0;
            const newTotal = (task.duration_seconds || 0) + session;
            task.status = "done";
            task.duration_seconds = newTotal;
            task.completed_at = new Date().toISOString();
            task.start_time = null;
            await client
              .from("tasks")
              .update({
                status: "done",
                duration_seconds: newTotal,
                completed_at: new Date().toISOString(),
                start_time: null,
              })
              .eq("id", task.id);
          };
          const deleteTask = async (id) => {
            if (!confirm("Á°ÆÂÆöÂà†Èô§Ê≠§‰ªªÂä°?")) return;
            tasks.value = tasks.value.filter((t) => t.id !== id);
            await client.from("tasks").delete().eq("id", id);
          };

          return {
            tasks,
            loading,
            showModal,
            showStats,
            showCalendar,
            newTask,
            quadrants,
            memoText,
            basketTask,
            currentTimerDisplay,
            timeDisplay,
            todayStats,
            weekStats,
            todayProgress,
            recentCompletedTasks,
            calendarTitle,
            calendarDays,
            changeMonth,
            selectDate,
            selectedDateFormatted,
            selectedDateTasks,
            openCalendar,
            getTasksByQuadrant,
            openAddModal,
            getQuadrantName,
            getQuadrantColor,
            getQuadrantTextColor,
            addTask,
            moveToBasket,
            pauseTask,
            completeTask,
            deleteTask,
            formatDuration,
            formatHours,
          };
        },
      }).mount("#app");
    </script>

    <style>
      .animate-fade-in {
        animation: fadeIn 0.3s ease-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </body>
</html>
